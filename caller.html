<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambola Caller - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-8 max-w-md">
        <h1 class="text-3xl font-bold mb-6 text-center">Tambola Game Controller</h1>

        <div class="bg-white p-6 rounded-lg shadow-lg space-y-4">
            <button id="start-game-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg">
                Start New Game (Reset Board)
            </button>
            <button id="call-number-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg">
                Call Next Number
            </button>
        </div>

        <div class="mt-6 bg-gray-50 p-4 rounded-lg shadow-inner">
            <h2 class="text-xl font-semibold mb-2">Game Status</h2>
            <p>Last Called: <span id="last-called" class="font-bold text-blue-600">--</span></p>
            <p>Total Called: <span id="total-called" class="font-bold">0</span></p>
            <div id="called-numbers-list" class="mt-2 text-sm text-gray-600 break-words">
                <!-- Called numbers will appear here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDz5rXqItBhZ1KcnP77brvJ47oZ0bUqYQU",
          authDomain: "tambola-gold.firebaseapp.com",
          projectId: "tambola-gold",
          storageBucket: "tambola-gold.appspot.com",
          messagingSenderId: "719738143899",
          appId: "1:719738143899:web:538dc685a0127a233a723e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const gameRef = db.collection('games').doc('currentGame');

        // --- Element Selectors ---
        const startGameBtn = document.getElementById('start-game-btn');
        const callNumberBtn = document.getElementById('call-number-btn');
        const lastCalledSpan = document.getElementById('last-called');
        const totalCalledSpan = document.getElementById('total-called');
        const calledNumbersList = document.getElementById('called-numbers-list');

        // --- Button Listeners ---
        startGameBtn.addEventListener('click', async () => {
            if (confirm('Are you sure you want to start a new game? This will reset the board.')) {
                await gameRef.set({ calledNumbers: [] });
                alert('New game started! Board has been reset.');
            }
        });

        callNumberBtn.addEventListener('click', async () => {
            const doc = await gameRef.get();
            if (!doc.exists) {
                alert('Game not started. Please start a new game first.');
                return;
            }

            const calledNumbers = doc.data().calledNumbers || [];
            if (calledNumbers.length >= 90) {
                alert('All numbers have been called!');
                return;
            }

            let nextNumber;
            do {
                nextNumber = Math.floor(Math.random() * 90) + 1;
            } while (calledNumbers.includes(nextNumber));

            await gameRef.update({
                calledNumbers: firebase.firestore.FieldValue.arrayUnion(nextNumber)
            });
        });

        // --- Real-time Status Update ---
        gameRef.onSnapshot((doc) => {
            if (doc.exists) {
                const calledNumbers = doc.data().calledNumbers || [];
                const total = calledNumbers.length;
                const last = total > 0 ? calledNumbers[total - 1] : '--';

                lastCalledSpan.innerText = last;
                totalCalledSpan.innerText = total;
                calledNumbersList.innerText = calledNumbers.join(', ');
            }
        });
    </script>
</body>
</html>
