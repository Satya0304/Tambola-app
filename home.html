<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambola Home - Gold Theme</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: "Poppins", sans-serif; }
.bg-primary-dark { background-color: #121212; }
.bg-secondary-dark { background-color: #1E1E1E; }
.bg-accent-gold { background-color: #F9A825; }
.text-gold { color: #F9A825; }
.border-gold { border-color: #F9A825; }
.text-light { color: #E0E0E0; }
.text-white-full { color: #FFFFFF; }
.mobile-screen {
    max-width: 414px; height: 800px; border: 16px solid #1E1E1E;
    border-radius: 36px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    overflow: hidden; display: flex; flex-direction: column; position: relative;
}
.modal-overlay {
    position: absolute; top:0; left:0; right:0; bottom:0;
    background-color: rgba(0,0,0,0.7); display:flex;
    align-items:center; justify-content:center; z-index:50;
}
</style>
</head>
<body class="bg-gray-800 flex items-center justify-center h-screen">
<div id="loading-view" class="text-white text-2xl">Loading...</div>

<div id="app-view" class="mobile-screen bg-primary-dark hidden">
<header class="bg-secondary-dark text-white-full p-4 flex justify-between items-center shadow-lg">
    <div class="flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
        <span id="username-display" class="font-semibold text-sm">@Player...</span>
    </div>
    <div class="flex items-center space-x-2 bg-black bg-opacity-25 px-3 py-1 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gold" viewBox="0 0 20 20" fill="currentColor"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" /><path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd" /></svg>
        <span id="wallet-balance" class="font-bold text-sm">₹--</span>
    </div>
</header>

<main class="flex-grow p-6 flex flex-col items-center justify-center space-y-8">
    <div class="w-full bg-secondary-dark rounded-2xl shadow-lg p-6 text-center border border-gray-700">
        <h1 class="text-gold font-bold text-2xl mb-4">Prize Pool</h1>
        <div class="space-y-2 text-light text-left">
            <div class="flex justify-between items-center"><span>Jaldi 5:</span><span id="jaldi5-prize" class="font-bold text-white-full">₹0</span></div>
            <div class="flex justify-between items-center"><span>Top Line:</span><span id="top-line-prize" class="font-bold text-white-full">₹0</span></div>
            <div class="flex justify-between items-center"><span>Middle Line:</span><span id="middle-line-prize" class="font-bold text-white-full">₹0</span></div>
            <div class="flex justify-between items-center"><span>Bottom Line:</span><span id="bottom-line-prize" class="font-bold text-white-full">₹0</span></div>
            <div class="flex justify-between items-center"><span>Full House:</span><span id="full-house-prize" class="font-bold text-white-full">₹0</span></div>
        </div>
    </div>
    <div class="bg-accent-gold text-black font-bold text-xl w-full py-3 px-6 rounded-xl shadow-lg text-center">
        Next Game In: 00:59
    </div>
</main>

<footer class="p-4 bg-secondary-dark/80 backdrop-blur-sm border-t border-gray-700">
<div class="flex items-center justify-center space-x-4">
    <button class="bg-gray-700 text-light font-bold py-3 px-6 rounded-xl shadow-md">Private Room</button>
    <button id="buy-tickets-btn" class="bg-accent-gold text-black font-bold py-3 px-8 rounded-xl shadow-lg flex-grow">BUY TICKETS</button>
</div>
</footer>

<!-- Ticket Purchase Modal -->
<div id="purchase-modal" class="modal-overlay hidden">
  <div class="bg-secondary-dark w-11/12 max-w-sm p-6 rounded-2xl shadow-lg border border-gray-700 text-center">
    <h2 class="text-gold font-bold text-2xl mb-6">Buy Tickets</h2>

    <!-- Quick select buttons -->
    <div class="flex flex-wrap justify-center gap-2 mb-4">
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">10</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">20</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">30</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">40</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">50</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">60</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">70</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">80</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">90</button>
      <button class="quick-ticket-btn bg-gray-700 px-3 py-1 rounded-lg">100</button>
    </div>

    <!-- Manual input -->
    <div class="mb-4">
      <label for="manual-ticket-input" class="text-light">Or enter ticket count:</label>
      <input id="manual-ticket-input" type="number" min="1" max="100" value="1"
             class="w-1/2 text-center rounded-lg py-1 text-black" />
    </div>

    <p class="text-light text-lg mb-6">Total Price: <span id="total-price" class="font-bold text-white-full">₹10</span></p>

    <button id="confirm-purchase-btn" class="w-full bg-accent-gold text-black font-bold py-3 rounded-lg text-lg mb-2">Confirm & Buy</button>
    <button id="cancel-purchase-btn" class="w-full text-light py-2">Cancel</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDz5rXqItBhZ1KcnP77brvJ47oZ0bUqYQU",
  authDomain: "tambola-gold.firebaseapp.com",
  projectId: "tambola-gold",
  storageBucket: "tambola-gold.appspot.com",
  messagingSenderId: "719738143899",
  appId: "1:719738143899:web:538dc685a0127a233a723e"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loadingView = document.getElementById('loading-view');
const appView = document.getElementById('app-view');
const usernameDisplay = document.getElementById('username-display');
const walletBalance = document.getElementById('wallet-balance');
const buyTicketsBtn = document.getElementById('buy-tickets-btn');
const purchaseModal = document.getElementById('purchase-modal');
const decreaseBtn = document.getElementById('decrease-btn');
const increaseBtn = document.getElementById('increase-btn');
const ticketCountSpan = document.getElementById('ticket-count');
const totalPriceSpan = document.getElementById('total-price');
const confirmPurchaseBtn = document.getElementById('confirm-purchase-btn');
const cancelPurchaseBtn = document.getElementById('cancel-purchase-btn');
const manualInput = document.getElementById('manual-ticket-input');
const quickBtns = document.querySelectorAll('.quick-ticket-btn');

let currentTicketCount = 1;
const TICKET_PRICE = 10;
let currentUserData = null;

function updateTicketUI(count) {
    currentTicketCount = Math.min(Math.max(count, 1), 100);
    ticketCountSpan.innerText = currentTicketCount;
    totalPriceSpan.innerText = '₹' + (currentTicketCount * TICKET_PRICE);
    manualInput.value = currentTicketCount;
}

// Quick select buttons
quickBtns.forEach(btn => btn.addEventListener('click', ()=> updateTicketUI(parseInt(btn.innerText))));

// Manual input
manualInput.addEventListener('input', ()=> updateTicketUI(parseInt(manualInput.value)||1));

// Buy modal open/close
buyTicketsBtn.addEventListener('click', ()=> purchaseModal.classList.remove('hidden'));
cancelPurchaseBtn.addEventListener('click', ()=> purchaseModal.classList.add('hidden'));

// Existing increase/decrease
increaseBtn.addEventListener('click', ()=> updateTicketUI(currentTicketCount+1));
decreaseBtn.addEventListener('click', ()=> updateTicketUI(currentTicketCount-1));

// Confirm purchase
confirmPurchaseBtn.addEventListener('click', async ()=>{
    const user = firebase.auth().currentUser;
    if(!user){alert('Please login first.'); return;}
    const totalCost = currentTicketCount*TICKET_PRICE;
    const userRef = db.collection('users').doc(user.uid);
    const doc = await userRef.get();
    if(doc.exists){
        currentUserData = doc.data();
        if(currentUserData.wallet>=totalCost){
            await userRef.update({wallet: currentUserData.wallet - totalCost});
            alert(`Purchase successful! ${currentTicketCount} tickets bought.`);
            window.location.href='./game.html';
        } else { alert('Insufficient balance.'); }
    }
});

// Prize pool
function updatePrizePool(){
    const ticketsSold=1250;
    const prizeDistribution={fullHouse:0.5,topLine:0.15,middleLine:0.15,bottomLine:0.15,jaldi5:0.05};
    const totalCollection=ticketsSold*TICKET_PRICE;
    const totalPrizePool=totalCollection*0.8;
    document.getElementById('full-house-prize').innerText='₹'+(totalPrizePool*prizeDistribution.fullHouse).toLocaleString();
    document.getElementById('top-line-prize').innerText='₹'+(totalPrizePool*prizeDistribution.topLine).toLocaleString();
    document.getElementById('middle-line-prize').innerText='₹'+(totalPrizePool*prizeDistribution.middleLine).toLocaleString();
    document.getElementById('bottom-line-prize').innerText='₹'+(totalPrizePool*prizeDistribution.bottomLine).toLocaleString();
    document.getElementById('jaldi5-prize').innerText='₹'+(totalPrizePool*prizeDistribution.jaldi5).toLocaleString();
}

// Firebase auth
window.onload = ()=>{
    try {
        if(!firebase||!firebase.auth) throw new Error("Firebase not loaded");
        auth.onAuthStateChanged(user=>{
            loadingView.classList.add('hidden');
            appView.classList.remove('hidden');
            if(user){
                db.collection('users').doc(user.uid).onSnapshot(doc=>{
                    if(doc.exists){
                        currentUserData=doc.data();
                        usernameDisplay.innerText=currentUserData.username||'@Player';
                        walletBalance.innerText='₹'+(currentUserData.wallet||0);
                    }
                });
                updatePrizePool();
            } else {
                console.warn("No user logged in. Page displayed for testing.");
            }
        });
    } catch(err){
        console.error("Firebase error:", err);
        loadingView.classList.add('hidden');
        appView.classList.remove('hidden');
    }
};
</script>
</body>
</html>
